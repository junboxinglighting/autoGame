<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>激活码验证接口测试工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .test-section {
            margin-bottom: 40px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .section-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .status-pending {
            background: #ffeaa7;
            color: #d63031;
        }
        
        .status-testing {
            background: #74b9ff;
            color: white;
        }
        
        .status-success {
            background: #00b894;
            color: white;
        }
        
        .status-error {
            background: #e17055;
            color: white;
        }
        
        .section-content {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background: #d68910;
        }
        
        .result-panel {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }
        
        .result-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .result-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .result-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #3498db;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .quick-fill {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .quick-fill-btn {
            padding: 5px 10px;
            background: #ecf0f1;
            border: 1px solid #bdc3c7;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .quick-fill-btn:hover {
            background: #d5dbdb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔐 激活码验证接口测试工具</h1>
            <p>全面测试激活码验证接口的各种功能和场景</p>
        </div>
        
        <div class="content">
            <!-- 统计面板 -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalTests">0</div>
                    <div class="stat-label">总测试次数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="successTests">0</div>
                    <div class="stat-label">成功次数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="failedTests">0</div>
                    <div class="stat-label">失败次数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="ipConflicts">0</div>
                    <div class="stat-label">IP冲突次数</div>
                </div>
            </div>
            
            <!-- 测试场景1：参数验证测试 -->
            <div class="test-section">
                <div class="section-header">
                    <div class="section-title">📋 参数验证测试</div>
                    <div class="status-badge status-pending" id="status-param">待测试</div>
                </div>
                <div class="section-content">
                    <p>测试接口对不同参数组合的验证逻辑</p>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="testMissingParams()">测试缺少参数</button>
                        <button class="btn btn-primary" onclick="testInvalidFormat()">测试无效格式</button>
                        <button class="btn btn-primary" onclick="testWrongMethod()">测试错误方法</button>
                    </div>
                    <div class="result-panel" id="result-param"></div>
                </div>
            </div>
            
            <!-- 测试场景2：正常激活流程测试 -->
            <div class="test-section">
                <div class="section-header">
                    <div class="section-title">✅ 正常激活流程测试</div>
                    <div class="status-badge status-pending" id="status-activate">待测试</div>
                </div>
                <div class="section-content">
                    <div class="quick-fill">
                        <button class="quick-fill-btn" onclick="fillTestData1()">填入测试数据1</button>
                        <button class="quick-fill-btn" onclick="fillTestData2()">填入测试数据2</button>
                        <button class="quick-fill-btn" onclick="clearForm()">清空表单</button>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="activateCode">激活码 *</label>
                            <input type="text" id="activateCode" placeholder="32位字母数字组合">
                        </div>
                        <div class="form-group">
                            <label for="activateUserId">用户ID *</label>
                            <input type="number" id="activateUserId" value="1" placeholder="用户ID">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="activateDeviceFingerprint">设备指纹 *</label>
                            <input type="text" id="activateDeviceFingerprint" value="test-device-001" placeholder="设备指纹">
                        </div>
                        <div class="form-group">
                            <label for="activateIp">IP地址 *</label>
                            <input type="text" id="activateIp" value="192.168.1.100" placeholder="IP地址">
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <button class="btn btn-success" onclick="testNormalActivation()">🚀 测试首次激活</button>
                        <button class="btn btn-primary" onclick="getAvailableCodes()">📝 获取可用激活码</button>
                    </div>
                    <div class="result-panel" id="result-activate"></div>
                </div>
            </div>
            
            <!-- 测试场景3：IP验证测试 -->
            <div class="test-section">
                <div class="section-header">
                    <div class="section-title">🌐 IP地址验证测试</div>
                    <div class="status-badge status-pending" id="status-ip">待测试</div>
                </div>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ipTestCode">已激活的激活码</label>
                            <input type="text" id="ipTestCode" placeholder="输入已激活的激活码">
                        </div>
                        <div class="form-group">
                            <label for="ipTestScenario">测试场景</label>
                            <select id="ipTestScenario">
                                <option value="same">相同IP验证</option>
                                <option value="different">不同IP验证</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ipTestIp">测试IP地址</label>
                            <input type="text" id="ipTestIp" value="192.168.1.200" placeholder="测试用的IP地址">
                        </div>
                        <div class="form-group">
                            <label for="ipTestDevice">设备指纹</label>
                            <input type="text" id="ipTestDevice" value="test-device-002" placeholder="设备指纹">
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <button class="btn btn-warning" onclick="testIpValidation()">🔍 测试IP验证</button>
                        <button class="btn btn-primary" onclick="testSameIp()">✅ 测试相同IP</button>
                        <button class="btn btn-primary" onclick="testDifferentIp()">❌ 测试不同IP</button>
                    </div>
                    <div class="result-panel" id="result-ip"></div>
                </div>
            </div>
            
            <!-- 测试场景4：综合测试 -->
            <div class="test-section">
                <div class="section-header">
                    <div class="section-title">🔬 综合功能测试</div>
                    <div class="status-badge status-pending" id="status-comprehensive">待测试</div>
                </div>
                <div class="section-content">
                    <p>一键运行所有测试场景，全面验证接口功能</p>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-success" onclick="runAllTests()" id="runAllBtn">🎯 运行全部测试</button>
                        <button class="btn btn-warning" onclick="runSpecificTests()">🔧 运行指定测试</button>
                        <button class="btn btn-primary" onclick="exportResults()">📊 导出测试报告</button>
                    </div>
                    <div class="result-panel" id="result-comprehensive"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 测试统计
        let testStats = {
            total: 0,
            success: 0,
            failed: 0,
            ipConflicts: 0
        };
        
        // 测试结果存储
        let testResults = [];
        
        // API基础URL
        const API_BASE = window.location.origin;
        
        // 更新统计显示
        function updateStats() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('successTests').textContent = testStats.success;
            document.getElementById('failedTests').textContent = testStats.failed;
            document.getElementById('ipConflicts').textContent = testStats.ipConflicts;
        }
        
        // 显示结果
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result-panel result-${type}`;
            element.textContent = content;
            element.style.display = 'block';
        }
        
        // 更新状态
        function updateStatus(sectionId, status) {
            const element = document.getElementById(`status-${sectionId}`);
            element.className = `status-badge status-${status}`;
            const statusText = {
                'pending': '待测试',
                'testing': '测试中',
                'success': '成功',
                'error': '失败'
            };
            element.textContent = statusText[status] || status;
        }
        
        // 记录测试结果
        function recordResult(testName, success, statusCode, message, data = null) {
            testStats.total++;
            if (success) {
                testStats.success++;
                if (statusCode === 1) {
                    // 激活成功
                } else if (statusCode === 3) {
                    testStats.ipConflicts++;
                }
            } else {
                testStats.failed++;
            }
            
            testResults.push({
                timestamp: new Date().toLocaleString(),
                testName,
                success,
                statusCode,
                message,
                data
            });
            
            updateStats();
        }
        
        // 快速填充测试数据
        function fillTestData1() {
            document.getElementById('activateCode').value = 'BEW6EDQCYDRBZNBQ4DJIJGTQYGA4993A';
            document.getElementById('activateUserId').value = '1';
            document.getElementById('activateDeviceFingerprint').value = 'test-device-001';
            document.getElementById('activateIp').value = '192.168.1.100';
        }
        
        function fillTestData2() {
            document.getElementById('activateCode').value = 'YSXK5SPD9UPPAFUTNPAQHVDC8AZ9T773';
            document.getElementById('activateUserId').value = '1';
            document.getElementById('activateDeviceFingerprint').value = 'test-device-002';
            document.getElementById('activateIp').value = '192.168.1.101';
        }
        
        function clearForm() {
            document.getElementById('activateCode').value = '';
            document.getElementById('activateUserId').value = '1';
            document.getElementById('activateDeviceFingerprint').value = 'test-device-001';
            document.getElementById('activateIp').value = '192.168.1.100';
        }
        
        // 获取可用激活码
        async function getAvailableCodes() {
            updateStatus('activate', 'testing');
            showResult('result-activate', '正在获取可用激活码...', 'info');
            
            try {
                // 这里模拟获取激活码的过程
                const codes = [
                    'BEW6EDQCYDRBZNBQ4DJIJGTQYGA4993A',
                    'YSXK5SPD9UPPAFUTNPAQHVDC8AZ9T773',
                    'U7JBENYSCCWTCARQCQSNGFYKJTAZN8T7',
                    'JTAKNHHXSD3XRRYQUMYGD8AHFEIDC754',
                    'DW2RSCC9AWRZCLQ7HWMPKXVTRHW37394'
                ];
                
                const result = `可用激活码列表：\n${codes.map((code, index) => `${index + 1}. ${code}`).join('\n')}\n\n点击任意激活码可自动填入表单`;
                showResult('result-activate', result, 'success');
                updateStatus('activate', 'success');
                
                // 添加点击事件
                setTimeout(() => {
                    document.getElementById('activateCode').value = codes[0];
                }, 100);
                
            } catch (error) {
                showResult('result-activate', `获取激活码失败: ${error.message}`, 'error');
                updateStatus('activate', 'error');
            }
        }
        
        // 测试缺少参数
        async function testMissingParams() {
            updateStatus('param', 'testing');
            showResult('result-param', '正在测试缺少参数的情况...', 'info');
            
            const testCases = [
                { data: {}, desc: '所有参数缺失' },
                { data: { code: 'TEST123' }, desc: '缺少userId、deviceFingerprint、ip' },
                { data: { code: 'TEST123', userId: 1 }, desc: '缺少deviceFingerprint、ip' },
                { data: { code: 'TEST123', userId: 1, deviceFingerprint: 'device1' }, desc: '缺少ip' },
            ];
            
            let results = '参数验证测试结果：\n\n';
            
            for (const testCase of testCases) {
                try {
                    const response = await fetch(`${API_BASE}/api/codes/validate`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(testCase.data)
                    });
                    
                    const result = await response.json();
                    results += `✅ ${testCase.desc}: ${response.status} - ${result.message || result.statusMessage}\n`;
                    
                    recordResult(`参数验证-${testCase.desc}`, response.status === 400, response.status, result.message);
                    
                } catch (error) {
                    results += `❌ ${testCase.desc}: 请求失败 - ${error.message}\n`;
                    recordResult(`参数验证-${testCase.desc}`, false, 0, error.message);
                }
            }
            
            showResult('result-param', results, 'info');
            updateStatus('param', 'success');
        }
        
        // 测试无效格式
        async function testInvalidFormat() {
            const testCases = [
                { code: '123', desc: '激活码过短' },
                { code: 'INVALID_CODE_TOO_LONG_XXXXXXXXXXXXX', desc: '激活码过长' },
                { code: 'INVALID-CODE-WITH-SPECIAL-CHARS!@#', desc: '包含特殊字符' },
            ];
            
            let results = '格式验证测试结果：\n\n';
            
            for (const testCase of testCases) {
                try {
                    const response = await fetch(`${API_BASE}/api/codes/validate`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            code: testCase.code,
                            userId: 1,
                            deviceFingerprint: 'test-device',
                            ip: '192.168.1.1'
                        })
                    });
                    
                    const result = await response.json();
                    results += `✅ ${testCase.desc}: ${response.status} - ${result.message || result.statusMessage}\n`;
                    
                } catch (error) {
                    results += `❌ ${testCase.desc}: 请求失败 - ${error.message}\n`;
                }
            }
            
            showResult('result-param', results, 'info');
        }
        
        // 测试错误的HTTP方法
        async function testWrongMethod() {
            try {
                const response = await fetch(`${API_BASE}/api/codes/validate`, {
                    method: 'GET'  // 错误的方法，应该是POST
                });
                
                const result = await response.json();
                const resultText = `HTTP方法测试结果：\n状态码: ${response.status}\n消息: ${result.message || result.statusMessage}`;
                showResult('result-param', resultText, response.status === 405 ? 'success' : 'error');
                
            } catch (error) {
                showResult('result-param', `HTTP方法测试失败: ${error.message}`, 'error');
            }
        }
        
        // 测试正常激活
        async function testNormalActivation() {
            const code = document.getElementById('activateCode').value;
            const userId = parseInt(document.getElementById('activateUserId').value);
            const deviceFingerprint = document.getElementById('activateDeviceFingerprint').value;
            const ip = document.getElementById('activateIp').value;
            
            if (!code || !userId || !deviceFingerprint || !ip) {
                showResult('result-activate', '请填写所有必填字段', 'error');
                return;
            }
            
            updateStatus('activate', 'testing');
            showResult('result-activate', '正在测试激活码验证...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/codes/validate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code, userId, deviceFingerprint, ip })
                });
                
                const result = await response.json();
                
                let resultText = `激活测试结果：\n`;
                resultText += `状态码: ${response.status}\n`;
                resultText += `成功: ${result.success}\n`;
                resultText += `消息: ${result.message}\n`;
                
                if (result.data) {
                    resultText += `\n详细信息：\n`;
                    resultText += `验证有效: ${result.data.valid}\n`;
                    resultText += `业务状态码: ${result.data.statusCode}\n`;
                    resultText += `详细消息: ${result.data.message}\n`;
                    
                    if (result.data.token) {
                        resultText += `Token: ${result.data.token.substring(0, 50)}...\n`;
                    }
                    
                    if (result.data.expiryTime) {
                        resultText += `过期时间: ${new Date(result.data.expiryTime).toLocaleString()}\n`;
                    }
                }
                
                const isSuccess = result.success && result.data?.statusCode === 1;
                showResult('result-activate', resultText, isSuccess ? 'success' : 'error');
                updateStatus('activate', isSuccess ? 'success' : 'error');
                
                recordResult('正常激活', result.success, result.data?.statusCode, result.data?.message, result.data);
                
                // 如果激活成功，将激活码填入IP测试表单
                if (isSuccess) {
                    document.getElementById('ipTestCode').value = code;
                }
                
            } catch (error) {
                showResult('result-activate', `激活测试失败: ${error.message}`, 'error');
                updateStatus('activate', 'error');
                recordResult('正常激活', false, 0, error.message);
            }
        }
        
        // 测试相同IP
        async function testSameIp() {
            const code = document.getElementById('ipTestCode').value || document.getElementById('activateCode').value;
            if (!code) {
                showResult('result-ip', '请先输入已激活的激活码', 'error');
                return;
            }
            
            updateStatus('ip', 'testing');
            showResult('result-ip', '正在测试相同IP验证...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/codes/validate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        code: code,
                        userId: 1,
                        deviceFingerprint: 'test-device-same',
                        ip: '192.168.1.100'  // 使用相同的IP
                    })
                });
                
                const result = await response.json();
                
                let resultText = `相同IP测试结果：\n`;
                resultText += `状态码: ${response.status}\n`;
                resultText += `成功: ${result.success}\n`;
                resultText += `业务状态码: ${result.data?.statusCode}\n`;
                resultText += `消息: ${result.data?.message}\n`;
                
                const isSuccess = result.success && result.data?.statusCode === 1;
                showResult('result-ip', resultText, isSuccess ? 'success' : 'info');
                updateStatus('ip', isSuccess ? 'success' : 'error');
                
                recordResult('相同IP验证', result.success, result.data?.statusCode, result.data?.message);
                
            } catch (error) {
                showResult('result-ip', `相同IP测试失败: ${error.message}`, 'error');
                updateStatus('ip', 'error');
            }
        }
        
        // 测试不同IP
        async function testDifferentIp() {
            const code = document.getElementById('ipTestCode').value || document.getElementById('activateCode').value;
            if (!code) {
                showResult('result-ip', '请先输入已激活的激活码', 'error');
                return;
            }
            
            updateStatus('ip', 'testing');
            showResult('result-ip', '正在测试不同IP验证...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/codes/validate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        code: code,
                        userId: 2,
                        deviceFingerprint: 'test-device-different',
                        ip: '192.168.1.200'  // 使用不同的IP
                    })
                });
                
                const result = await response.json();
                
                let resultText = `不同IP测试结果：\n`;
                resultText += `状态码: ${response.status}\n`;
                resultText += `成功: ${result.success}\n`;
                resultText += `业务状态码: ${result.data?.statusCode}\n`;
                resultText += `消息: ${result.data?.message}\n`;
                
                if (result.data?.statusCode === 3) {
                    resultText += `\n✅ IP冲突检测正常工作！`;
                }
                
                const isExpected = result.data?.statusCode === 3;  // 期望返回状态码3
                showResult('result-ip', resultText, isExpected ? 'success' : 'error');
                updateStatus('ip', isExpected ? 'success' : 'error');
                
                recordResult('不同IP验证', !result.success, result.data?.statusCode, result.data?.message);
                
            } catch (error) {
                showResult('result-ip', `不同IP测试失败: ${error.message}`, 'error');
                updateStatus('ip', 'error');
            }
        }
        
        // 测试IP验证
        async function testIpValidation() {
            await testSameIp();
            setTimeout(async () => {
                await testDifferentIp();
            }, 1000);
        }
        
        // 运行所有测试
        async function runAllTests() {
            const btn = document.getElementById('runAllBtn');
            btn.disabled = true;
            btn.textContent = '🔄 测试进行中...';
            
            updateStatus('comprehensive', 'testing');
            showResult('result-comprehensive', '开始运行全面测试...\n\n', 'info');
            
            try {
                // 重置统计
                testStats = { total: 0, success: 0, failed: 0, ipConflicts: 0 };
                testResults = [];
                updateStats();
                
                // 1. 参数验证测试
                showResult('result-comprehensive', '1. 正在进行参数验证测试...\n', 'info');
                await testMissingParams();
                await new Promise(r => setTimeout(r, 500));
                
                // 2. 格式验证测试
                showResult('result-comprehensive', '1. 参数验证测试完成\n2. 正在进行格式验证测试...\n', 'info');
                await testInvalidFormat();
                await new Promise(r => setTimeout(r, 500));
                
                // 3. HTTP方法测试
                showResult('result-comprehensive', '1. 参数验证测试完成\n2. 格式验证测试完成\n3. 正在进行HTTP方法测试...\n', 'info');
                await testWrongMethod();
                await new Promise(r => setTimeout(r, 500));
                
                // 4. 正常激活测试
                showResult('result-comprehensive', '1. 参数验证测试完成\n2. 格式验证测试完成\n3. HTTP方法测试完成\n4. 正在进行正常激活测试...\n', 'info');
                fillTestData1();  // 自动填充测试数据
                await testNormalActivation();
                await new Promise(r => setTimeout(r, 1000));
                
                // 5. IP验证测试
                showResult('result-comprehensive', '1. 参数验证测试完成\n2. 格式验证测试完成\n3. HTTP方法测试完成\n4. 正常激活测试完成\n5. 正在进行IP验证测试...\n', 'info');
                await testIpValidation();
                await new Promise(r => setTimeout(r, 1000));
                
                // 生成测试报告
                const report = generateTestReport();
                showResult('result-comprehensive', report, 'success');
                updateStatus('comprehensive', 'success');
                
            } catch (error) {
                showResult('result-comprehensive', `全面测试过程中出现错误: ${error.message}`, 'error');
                updateStatus('comprehensive', 'error');
            }
            
            btn.disabled = false;
            btn.textContent = '🎯 运行全部测试';
        }
        
        // 生成测试报告
        function generateTestReport() {
            let report = '📊 测试报告\n';
            report += '=' * 50 + '\n\n';
            report += `测试时间: ${new Date().toLocaleString()}\n`;
            report += `总测试数: ${testStats.total}\n`;
            report += `成功数: ${testStats.success}\n`;
            report += `失败数: ${testStats.failed}\n`;
            report += `IP冲突数: ${testStats.ipConflicts}\n`;
            report += `成功率: ${testStats.total > 0 ? ((testStats.success / testStats.total) * 100).toFixed(2) : 0}%\n\n`;
            
            report += '详细测试结果:\n';
            report += '-' * 30 + '\n';
            
            testResults.forEach((result, index) => {
                report += `${index + 1}. ${result.testName}\n`;
                report += `   时间: ${result.timestamp}\n`;
                report += `   结果: ${result.success ? '✅ 成功' : '❌ 失败'}\n`;
                report += `   状态码: ${result.statusCode}\n`;
                report += `   消息: ${result.message}\n\n`;
            });
            
            return report;
        }
        
        // 导出测试报告
        function exportResults() {
            const report = generateTestReport();
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `activation-test-report-${new Date().getTime()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            console.log('激活码验证接口测试工具已加载');
        });
    </script>
</body>
</html>
